import{u as j}from"./list-9ca415c0.js";import{u as W}from"./settings-ecd1086f.js";import{g as B,o as D,a as E,n as F,u as C,b as U,r as N,w as R,c as _,s as A,d as q,e as H,f as b,V as $,h as g,i as I,t as P,j as k}from"./index-d499ab48.js";import{V,a as z}from"./VRow-ce6893d7.js";function x(e){return B()?(D(e),!0):!1}function T(){const e=new Set,t=o=>{e.delete(o)};return{on:o=>{e.add(o);const r=()=>t(o);return x(r),{off:r}},off:t,trigger:(...o)=>Promise.all(Array.from(e).map(r=>r(...o)))}}function G(e){return typeof e=="function"?e():C(e)}const J=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const K=Object.prototype.toString,Q=e=>K.call(e)==="[object Object]",X=()=>{};function Y(e){return e||U()}function Z(e,t=!0,n){Y()?E(e,n):t?e():F(e)}function ee(e){var t;const n=G(e);return(t=n==null?void 0:n.$el)!=null?t:n}const L=J?window:void 0;function te(...e){let t,n,s,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,s,o]=e,t=L):[t,n,s,o]=e,!t)return X;Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);const r=[],a=()=>{r.forEach(u=>u()),r.length=0},p=(u,i,l,c)=>(u.addEventListener(i,l,c),()=>u.removeEventListener(i,l,c)),h=R(()=>[ee(t),G(o)],([u,i])=>{if(a(),!u)return;const l=Q(i)?{...i}:i;r.push(...n.flatMap(c=>s.map(m=>p(u,c,m,l))))},{immediate:!0,flush:"post"}),v=()=>{h(),a()};return x(v),v}function ne(){const e=N(!1);return U()&&E(()=>{e.value=!0}),e}function oe(e){const t=ne();return _(()=>(t.value,!!e()))}function re(e={}){const{window:t=L,requestPermissions:n=!0}=e,s=e,o=oe(()=>!!t&&"Notification"in t),r=N(o.value&&"permission"in Notification&&Notification.permission==="granted"),a=N(null),p=async()=>{if(o.value)return!r.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(r.value=!0),r.value},{on:h,trigger:v}=T(),{on:u,trigger:i}=T(),{on:l,trigger:c}=T(),{on:m,trigger:O}=T(),w=async d=>{if(!o.value||!r.value)return;const f=Object.assign({},s,d);return a.value=new Notification(f.title||"",f),a.value.onclick=v,a.value.onshow=i,a.value.onerror=c,a.value.onclose=O,a.value},S=()=>{a.value&&a.value.close(),a.value=null};if(n&&Z(p),x(S),o.value&&t){const d=t.document;te(d,"visibilitychange",f=>{f.preventDefault(),d.visibilityState==="visible"&&S()})}return{isSupported:o,notification:a,ensurePermissions:p,permissionGranted:r,show:w,close:S,onClick:h,onShow:u,onError:l,onClose:m}}const ue={__name:"HomeView",setup(e){const t=j(),{currentItem:n,items:s,timeleft:o}=A(t),{setCurrentItem:r,countdown:a,setFinishedItem:p}=t,h=W(),{selectedAlarmFile:v,notify:u}=A(h),i={STOP:0,COUNTING:1,PAUSE:2},l=N(i.STOP);let c=0;const m=()=>{l.value===i.STOP&&s.value.length>0&&r(),l.value=i.COUNTING,c=setInterval(()=>{a(),o.value===0&&w()},1e3)},O=()=>{l.value=i.PAUSE,clearInterval(c)},w=()=>{clearInterval(c),l.value=i.STOP;const f=new Audio;if(f.src=v.value,f.play(),u.value){const{show:y,isSupported:M}=re({title:"事項完成",body:n.value,icon:new URL(""+new URL("apple-a723d1cf.png",import.meta.url).href,self.location).href});M.value&&y()}p(),s.value.length>0&&m()},S=_(()=>n.value.length>0?n.value:s.value.length>0?"點擊開始":"沒有事項"),d=_(()=>{const f=Math.floor(o.value/60).toString().padStart(2,"0"),y=(o.value%60).toString().padStart(2,"0");return f+":"+y});return(f,y)=>(q(),H($,null,{default:b(()=>[g(z,{style:{"background-color":"#d4c0ba72","border-radius":"20px",width:"60%",margin:"auto","margin-top":"10%"}},{default:b(()=>[g(V,{cols:"12",class:"text-center text-white"},{default:b(()=>[I("h1",null,P(S.value),1),I("h1",null,P(d.value),1)]),_:1}),g(V,{cols:"12",class:"text-center"},{default:b(()=>[g(k,{variant:"text",icon:"mdi-play",disabled:l.value===i.COUNTING||C(n).length===0&&C(s).length===0,onClick:m},null,8,["disabled"]),g(k,{variant:"text",icon:"mdi-pause",disabled:l.value!==i.COUNTING,onClick:O},null,8,["disabled"]),g(k,{variant:"text",icon:"mdi-skip-next",disabled:C(n).length===0,onClick:w},null,8,["disabled"])]),_:1})]),_:1})]),_:1}))}};export{ue as default};
